<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Khai Báo Y Tế</title>
    <th:block th:replace="layout::cssAll"></th:block>
</head>
<body>
    <nav th:replace="layout::topBar"></nav>
    <div class="container">
        <div class="container-fluid inside">
            <div class="row align-items-center">
                <h3>Tờ khai y tế</h3>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="form-group col-sm-12 col-lg-8">
                        <label for="entry_gate">Cửa khẩu <span>(*)</span></label>
                        <select class="form-control select_search" id="entry_gate">
                            <th:block th:each="gate:${gates}">
                                <option th:value="${gate.id}" th:text="${gate.name}"></option>
                            </th:block>

                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-12 col-md-8">
                        <label for="person_legalDocument">Số hộ chiếu hoặc giấy thông hành hợp pháp khác <span>(*)</span></label>
                        <input type="text" class="form-control" id="person_legalDocument" maxlength="50">
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-12 col-md-8">
                        <label for="person_name">Họ tên <span>(*)</span></label>
                        <input type="text" class="form-control" id="person_name"
                               maxlength="200">
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-12 col-md-4">
                        <label for="person_birthYear">Năm sinh <span>(*)</span></label>
                        <select class="form-control" id="person_birthYear">
                        </select>
                    </div>
                    <div class="form-group col-sm-12 col-md-4">
                        <label for="person_gender">Giới tính <span>(*)</span></label>
                        <select class="form-control" id="person_gender">
                            <option value="0">Nam</option>
                            <option value="1">Nữ</option>
                            <option value="2">Khác</option>
                        </select>
                    </div>
                    <div class="form-group col-sm-12 col-md-4">
                        <label for="person_nationality">Quốc tịch <span>(*)</span></label>
                        <select class="form-control select_search" id="person_nationality" >
                            <th:block th:each="nationality:${nationals}">
                                <option th:value="${nationality.id}" th:text="${nationality.name}"></option>
                            </th:block>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label for="transportType">Phương tiện <span>(*)</span></label>
                        <select class="form-control" id="transportType">
                            <th:block th:each="transportType:${transportTypes}">
                                <option th:value="${transportType.id}" th:text="${transportType.name}"></option>
                            </th:block>
                        </select>
                    </div>
                    <div class="form-group col-sm-12">
                        <label for="transport_note">Ghi chú (Cho phương tiện di chuyển)</label>
                        <textarea type="text" class="form-control" id="transport_note"></textarea>
                    </div>
                    <div class="form-group col-sm-12 col-lg-6">
                        <label for="transport_transportationNo">Số hiệu phương tiện</label>
                        <input type="text" class="form-control" id="transport_transportationNo" maxlength="72">
                    </div>
                    <div class="form-group col-sm-12 col-lg-6">
                        <label for="entry_seatNo">Số ghế</label>
                        <input type="text" class="form-control" id="entry_seatNo" maxlength="32">
                    </div>
                    <div class="form-group col-sm-12 col-lg-6">
                        <label for="entry_departureDate">Ngày khởi hành <span>(*)</span></label>
                        <input type="date" class="form-control" id="entry_departureDate">
                    </div>
                    <div class="form-group col-sm-12 col-lg-6">
                        <label for="entry_immigrationDate">Ngày nhập cảnh <span>(*)</span></label>
                        <input type="date" class="form-control" id="entry_immigrationDate">
                    </div>
                    <div class="col-sm-12">
                        <p>Địa điểm khởi hành (tỉnh/quốc gia)</p>
                    </div>
                    <div class="form-group col-sm-6">
                        <label for="national_Departure">Quốc gia/ Vùng lãnh thổ <span>(*)</span></label>
                        <select class="form-control select_search" id="national_Departure">
                            <th:block th:each="national:${nationals}">
                                <option th:value="${national.id}" th:text="${national.name}"></option>
                            </th:block>
                        </select>
                    </div>
                    <div class="form-group col-sm-6">
                        <label for="entry_provinceDeparture">Tỉnh <span>(*)</span></label>
                        <select class="form-control select_search" id="entry_provinceDeparture">
                        </select>
                    </div>
                    <div class="col-sm-12">
                        <p>Địa điểm nơi đến (tỉnh/quốc gia)</p>
                    </div>
                    <div class="form-group col-sm-6">
                        <label for="national_destination">Quốc gia/ Vùng lãnh thổ <span>(*)</span></label>
                        <select class="form-control select_search" id="national_destination">
                            <th:block th:each="national:${nationals}">
                                <option th:value="${national.id}" th:text="${national.name}"></option>
                            </th:block>
                        </select>
                    </div>
                    <div class="form-group col-sm-6">
                        <label for="entry_provinceDestination">Tỉnh <span>(*)</span></label>
                        <select class="form-control select_search" id="entry_provinceDestination">
                        </select>
                    </div>
                    <div class="col-sm-12">
                        <label for="entry_placeTravel">
                            Trong vòng 14 ngày qua, Anh/Chị có đến quốc gia/vùng lãnh thổ nào? <span>(*)</span>
                        </label>
                        <select class="js-example-basic-multiple" name="states[]" multiple="multiple" id="entry_placeTravel">
                            <th:block th:each="national:${nationals}">
                                <option th:value="${national.id}" th:text="${national.name}"></option>
                            </th:block>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <p class="declare_tittle">Địa chỉ liên lạc tại Việt Nam<p>
                    </div>
                    <div class="col-sm-12 col-lg-3 form-group">
                        <label for="contact_Province">Tỉnh <span>(*)</span></label>
                        <select class="form-control" id="contact_Province">
                        </select>
                    </div>
                    <div class="col-sm-12 col-lg-3 form-group">
                        <label for="contact_District">Quận / huyện <span>(*)</span></label>
                        <select class="form-control" id="contact_District">
                        </select>
                    </div>
                    <div class="col-sm-12 col-lg-3 form-group">
                        <label for="contact_District">Phường / xã  <span>(*)</span></label>
                        <select class="form-control" id="contact_Location">
                        </select>
                    </div>
                    <div class="col-sm-12 form-group">
                        <label for="contact_address">
                            Địa chỉ nơi ở tại Việt Nam <span>(*)</span>
                        </label>
                        <textarea type="text" class="form-control" id="contact_address" maxlength="240"></textarea>
                    </div>
                    <div class="col-sm-12">
                        <small>
                            Số điện thoại bạn sẽ sử dụng tại Việt Nam (Là số Roaming hoặc số Việt Nam)
                        </small>
                    </div>
                    <div class="col-sm-12 col-lg-6">
                        <label for="contact_phone">Điện thoại <span>(*)</span></label>
                        <input type="tel" class="form-control" id="contact_phone">
                    </div>
                    <div class="col-sm-12 col-lg-6">
                        <label for="contact_email">Email </label>
                        <input type="email" class="form-control" id="contact_email">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <p class="declare_tittle">
                            Trong vòng 14 ngày (tính đến thời điểm làm thủ tục xuất cảnh, nhập cảnh, quá cảnh) Anh/Chị có thấy xuất hiện dấu hiệu nào sau đây không? (*)
                        <p>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th style="width: 80%">Triệu chứng</th>
                                        <th style="width: 10%">Có</th>
                                        <th style="width: 10%">Không</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="symptom:${symptoms}">
                                        <td th:text="${symptom.name}">
                                        </td>
                                        <td>
                                            <input type="radio" class="form-check-input symptom_checkbox"
                                                th:name="${symptom.id}" value="1">
                                        </td>
                                        <td>
                                            <input type="radio" class="form-check-input symptom_checkbox"
                                                   th:name="${symptom.id}" value="0">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <label for="entry_listCure">
                            Danh sách vắc-xin hoặc sinh phẩm được sử dụng
                        </label>
                        <input type="text" class="form-control" id="entry_listCure">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <p class="declare_tittle">Lịch sử phơi nhiễm: Trong vòng 14 ngày qua, Anh/Chị có <span>(*)</span></p>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th style="width: 80%"></th>
                                    <th style="width: 10%">Có</th>
                                    <th style="width: 10%">Không</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="exposure:${exposures}">
                                    <td th:text="${exposure.name}">
                                    </td>
                                    <td>
                                        <input type="radio" class="form-check-input exposure_checkbox"
                                               th:name="${exposure.id}" value="1">
                                    </td>
                                    <td>
                                        <input type="radio" class="form-check-input exposure_checkbox"
                                               th:name="${exposure.id}" value="0">
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <button type="button" class="btn btn-primary"
                        onclick="healthDeclaration()">
                        GỬI TỜ KHAI
                    </button>
                </div>
            </div>
        </div>

    </div>
    <footer th:replace="layout::bottomBar"></footer>
    <th:block th:replace="layout::jsAll"></th:block>
    <script th:src="@{/js/web/declare.js}"></script>
    <script>
        $(document).ready(function () {
            var birth = $("#person_birthYear");
            birth.html("");
            var end = new Date().getFullYear(),
                begin = end - 200;
            begin = begin>0 ? begin:1900;
            for (var year = begin; year<=end; year++){
                birth.append("<option value='" + year + "'>" + year + "</option>");
            }
            birth.val(end-25);

            $(".select_search").select2();

            declare.getProvince($("#national_Departure").val(), $("#entry_provinceDeparture"));
            declare.getProvince($("#national_destination").val(), $("#entry_provinceDestination"));
            declare.getProvinceForLocation($("#contact_Province"),$("#contact_District"),$("#contact_Location"));
        });
        $("#national_Departure").change(
            function () {
                declare.getProvince($(this).val(), $("#entry_provinceDeparture"));
            }
        );
        $("#national_destination").change(
            function () {
                declare.getProvince($(this).val(), $("#entry_provinceDestination"));
            }
        );
        $("#contact_Province").change(
            function () {
                declare.getDistrictForLocation($(this).val(),$("#contact_District"),$("#contact_Location"));
            }
        );
        $("#contact_District").change(
            function () {
                declare.getWard($(this).val(),$("#contact_Location"));
            }
        );
        
        function getEntry(transportId, personId) {
            return {
                "gate": $("#entry_gate").val(),
                "transport": transportId,
                "seatNo": $("#entry_seatNo").val(),
                "departureDate": $("#entry_departureDate").val(),
                "immigrationDate": $("#entry_immigrationDate").val(),
                "placeTravel": $("#entry_placeTravel").val(),
                "provinceDeparture": $("#entry_provinceDeparture").val(),
                "provinceDestination": $("#entry_provinceDestination").val(),
                "person": personId,
                "contactHelpDeclare": null,
                "statuses": null,
                "listCure": $("#entry_listCure"),
                "historyOfExposures": null
            };
        }
        function getPerson() {
            return {
                "legalDocument": $("#person_legalDocument").val(),
                "name": $("#person_name").val(),
                "birthYear": $("#person_birthYear").val(),
                "gender": $("#person_gender").val(),
                "Nationality": {
                    "id": $("#person_nationality").val()
                }
            };
        }
        function getContact() {
            var namePersonEntry = $("#person_name").val();
            return {
                "name": namePersonEntry,
                "person": null,
                "location": {
                    "id": $("#contact_Location").val()
                },
                "address": $("#contact_address").val(),
                "phone": $("#contact_phone").val(),
                "email": $("#contact_email").val(),
                "create_by":namePersonEntry
            };
        }
        function getTransport() {
            return {
                "transportType": $("#transportType").val(),
                "transportationNo": $("#transport_transportationNo").val(),
                "note": $("#transport_note").val()
            };
        }
        function getStatuses() {
            var length = 0,
                idSymptom = 0,
                checkSymptom = 0,
                status = [];
            $(".symptom_checkbox").map(
                function( index ){
                    if ($(this).prop("checked")){
                        idSymptom = $(this).attr("name");
                        checkSymptom = $(this).val();
                        status.push(
                            {
                                "symptom":{
                                    "id":idSymptom
                                },
                                "haveSymptom": checkSymptom
                            }
                        );
                    }
                    length = index;
                }
            );
            if ( (length + 1) !== (status.length*2)){
                console.log("Khai Báo Thiếu Tình Trạng Sức Khỏe: " + status.length + "/" + (length/2));
                return null;
            }
            else{
                console.log("Khai Báo Đủ Tình Trạng Sức Khỏe");
                return status;
            }
        }
        function getHistoryOfExposure() {
            var length = 0,
                idExposure = 0,
                checkExposure = 0,
                history_of_exposure = [];
            $(".exposure_checkbox").map(
                function( index ){
                    if ($(this).prop("checked")){
                        idExposure = $(this).attr("name");
                        checkExposure = $(this).val();
                        history_of_exposure.push(
                            {
                                "exposure":{
                                    "id":idExposure
                                },
                                "hasExposure": checkExposure
                            }
                        );
                    }
                    length = index;
                }
            );
            if ( (length + 1) !== (history_of_exposure.length*2)){
                console.log("Khai Báo Thiếu Lịch Sử Phơi Nhiễm:" + history_of_exposure.length + "/" + (length/2));
                return null;
            }
            else{
                console.log("Khai Báo Đủ Lịch Sử Phơi Nhiễm");
                return history_of_exposure;
            }
        }

    </script>
</body>
</html>